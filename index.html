<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kawaii Heart Seeker | Perfect Match Engine</title>
    <!-- Kawaii Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- Animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --kawaii-pink: #ffc2d1;
            --kawaii-pink-dark: #ff85a1;
            --kawaii-mint: #e2f0cb;
            --kawaii-lavender: #e0c3fc;
            --kawaii-cream: #fff9f0;
            --kawaii-text: #4a3050;
            --kawaii-white: #ffffff;
            --glass: rgba(255, 255, 255, 0.45);
            --bg-main: #fff5f7;
            --holographic: linear-gradient(135deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.9) 50%, rgba(255,255,255,0) 100%);
            --shadow: 0 20px 60px rgba(255, 133, 161, 0.15);
        }

        /* Theme Variants */
        body.theme-ocean {
            --kawaii-pink: #bde0fe;
            --kawaii-pink-dark: #457b9d;
            --kawaii-mint: #a2d2ff;
            --kawaii-lavender: #ffafcc;
            --bg-main: #f0f7ff;
        }

        body.theme-forest {
            --kawaii-pink: #ccd5ae;
            --kawaii-pink-dark: #606c38;
            --kawaii-mint: #e9edc9;
            --kawaii-lavender: #faedcd;
            --bg-main: #f5f5f0;
        }

        body.theme-moonlight {
            --kawaii-pink: #483d8b;
            --kawaii-pink-dark: #9370db;
            --kawaii-mint: #191970;
            --kawaii-lavender: #4b0082;
            --kawaii-text: #e6e6fa;
            --bg-main: #0c0c1e;
            --kawaii-white: #1a1a2e;
            --kawaii-cream: #16213e;
            --glass: rgba(0, 0, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Fredoka', sans-serif;
        }

        body {
            background: var(--bg-main);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
            margin: 0;
            overflow-x: hidden;
            font-family: 'Fredoka', sans-serif;
            color: var(--kawaii-text);
            transition: background 0.5s ease;
        }



        /* Enter Overlay */
        .enter-overlay {
            position: fixed;
            inset: 0;
            background: #f5576c;
            z-index: 100000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            transition: opacity 0.2s ease, transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow: hidden;
            perspective: 1500px;
        }

        .cinematic-vignette {
            position: absolute;
            inset: 0;
            background: radial-gradient(circle, transparent 40%, rgba(0,0,0,0.4) 150%);
            z-index: -1;
            pointer-events: none;
        }

        .mascot-container {
            z-index: 20;
            width: 250px; 
            margin-bottom: 20px;
            position: relative;
            transform-style: preserve-3d;
            background: transparent !important; /* Force transparent */
            isolation: isolate; /* Create new stacking context for blending */
        }
        .mascot-container img {
            width: 100%;
            height: auto;
            mix-blend-mode: multiply; /* Blends white box into pink background */
            display: block;
            position: relative;
            z-index: 21;
        }

        .enter-overlay.zoom-exit {
            opacity: 0;
            transform: scale(2); /* Fly through effect */
            pointer-events: none;
        }

        .enter-overlay.hidden {
            display: none;
        }

        .mascot-container img {
            width: 250px; 
            margin-bottom: 20px;
            mix-blend-mode: multiply; 
            display: block;
            animation: springUp 0.3s ease-out forwards;
        }

        .central-plate {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 650px; height: 650px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 70%);
            z-index: 0;
            pointer-events: none;
            filter: blur(20px);
        }

        .enter-overlay h1 {
            animation: titleEntrance 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards, titleShimmer 3s ease-in-out infinite;
            color: #ffd700;
            background: linear-gradient(to bottom, #fff 20%, #ffd700 80%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 15px #ff1a7d) drop-shadow(0 0 30px #ff1a7d);
            font-family: 'Fredoka One', cursive;
            font-size: 6rem !important;
            font-weight: 900;
            letter-spacing: -3px;
            z-index: 30;
            margin-bottom: 40px;
            transform: translateZ(100px);
            position: relative;
        }

        @keyframes titleEntrance {
            from { transform: translateZ(-500px) translateY(100px); opacity: 0; }
            to { transform: translateZ(50px) translateY(0); opacity: 1; }
        }

        @keyframes titleShimmer {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.05); filter: brightness(1.3); }
        }

        /* 3D Masterpiece Tunnel Enhanced */
        .master-heart {
            position: absolute;
            top: 50%; left: 50%;
            width: 60px; height: 60px;
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(8px);
            clip-path: path('M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z');
            animation: tunnelZoom 4s linear forwards; /* Faster tunnel */
            pointer-events: none;
            z-index: 1;
        }
        .satin-overlay {
            position: absolute;
            inset: -50%;
            width: 200%; height: 200%;
            background: 
                radial-gradient(circle at 30% 30%, #f093fb 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, #f5576c 0%, transparent 50%),
                radial-gradient(circle at 20% 80%, #ff85a1 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, #4facfe 0%, transparent 50%);
            filter: blur(80px);
            z-index: -2;
            animation: satinShift 15s ease-in-out infinite alternate;
            opacity: 0.8;
            pointer-events: none;
        }

        @keyframes satinShift {
            0% { transform: rotate(0deg) scale(1); }
            100% { transform: rotate(15deg) scale(1.1); }
        }

        .master-heart {
            position: absolute;
            top: 50%; left: 50%;
            width: 50px; height: 50px;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(5px);
            clip-path: path('M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z');
            animation: tunnelZoom 6s linear forwards;
            pointer-events: none;
            z-index: 1;
        }

        @keyframes tunnelZoom {
            from { transform: translate(-50%, -50%) translateZ(-2000px) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translate(-50%, -50%) translateZ(1200px) rotate(720deg); opacity: 0; }
        }

        /* PETAL STORM EFFECT */
        .petal-storm {
            position: fixed;
            width: 30px; height: 18px;
            background: #ffb7b2;
            border-radius: 80% 10% 80% 10%;
            z-index: 100003;
            pointer-events: none;
            box-shadow: 0 0 15px rgba(255, 183, 178, 0.6);
            animation: stormDrift 8s linear infinite;
        }

        @keyframes stormDrift {
            0% { transform: translate(-10vw, -10vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            100% { transform: translate(110vw, 110vh) rotate(1440deg); opacity: 0; }
        }

        .neon-border {
            position: fixed;
            inset: 0;
            border: 10px solid transparent;
            box-shadow: inset 0 0 50px #ff1a7d, 0 0 50px #ff1a7d;
            border-image: linear-gradient(45deg, #ff1a7d, #f093fb) 1;
            z-index: 100004;
            pointer-events: none;
            opacity: 0.2;
            animation: borderPulse 4s infinite alternate;
        }

        @keyframes borderPulse {
            from { opacity: 0.1; }
            to { opacity: 0.4; }
        }

        .enter-btn {
            background: linear-gradient(135deg, #ff1a7d 0%, #ff85a1 100%);
            color: white;
            border: 2px solid rgba(255,255,255,0.4);
            padding: 20px 50px;
            border-radius: 50px;
            font-size: 1.5rem;
            font-weight: 800;
            animation: springUp 1s 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) backwards, breathe 3s 1.6s ease-in-out infinite;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 30px rgba(255, 26, 125, 0.6);
            z-index: 10;
        }

        @keyframes springUp {
            from { transform: translateY(100px) scale(0.5); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); box-shadow: 0 15px 35px rgba(255, 133, 161, 0.6); }
        }

        .enter-btn:hover {
            transform: scale(1.1) rotate(-2deg);
            box-shadow: 0 15px 40px rgba(255, 133, 161, 0.5);
        }

        .overlay-mascot {
            font-size: 5rem;
            animation: bounce 2s infinite ease-in-out;
        }

        .bg-blobs {
            position: fixed;
            inset: 0;
            z-index: -1;
            filter: url('#gooey') blur(25px);
            opacity: 0.6;
            overflow: hidden;
            background: var(--bg-main);
        }

        /* Canvas Particles */
        #sparkleCanvas {
            position: fixed;
            inset: 0;
            z-index: 100000;
            pointer-events: none;
        }

        .bg-pattern {
            position: fixed;
            inset: 0;
            z-index: -1;
            background-image: radial-gradient(var(--kawaii-pink) 1.5px, transparent 1.5px);
            background-size: 40px 40px;
            opacity: 0.1;
            transition: all 0.5s ease;
        }

        /* Grand Reveal God Rays */
        .god-rays {
            position: fixed;
            top: 50%; left: 50%;
            width: 200vmax; height: 200vmax;
            background: repeating-conic-gradient(from 0deg, rgba(255,255,255,0.4) 0deg 15deg, transparent 15deg 30deg);
            transform: translate(-50%, -50%);
            z-index: 99990; /* Behind glow, front of content */
            opacity: 0;
            pointer-events: none;
            mix-blend-mode: overlay;
        }

        @keyframes rayRotate {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }


        /* MOOD SHIFT: Valentine Sunset (Special Edition) */
        body.theme-default .bg-pattern {
            background-color: #ff9a9e;
            background-image: 
                /* Hill 1 (Foreground) - Mauve */
                radial-gradient(circle at 20% 120%, #9795f0 30%, transparent 30.2%),
                /* Hill 2 (Midground) - Lavender */
                radial-gradient(circle at 80% 120%, #e0c3fc 40%, transparent 40.2%),
                /* Valentine Sunset Gradient */
                linear-gradient(to top, #ffecd2 0%, #fcb69f 100%);
            background-size: 100% 100%;
            background-repeat: no-repeat;
            opacity: 1;
        }

        /* VALENTINE'S DREAM: Bokeh & Aura */
        .bokeh-heart {
            position: fixed;
            width: 50px;
            height: 50px;
            background: rgba(255, 133, 161, 0.3);
            filter: blur(15px);
            clip-path: path('M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z');
            animation: bokehDrift 15s linear infinite;
            pointer-events: none;
            z-index: 100001;
        }

        @keyframes bokehDrift {
            from { transform: translate(0, 0) scale(1); opacity: 0; }
            5% { opacity: 0.8; }
            95% { opacity: 0.8; }
            to { transform: translate(100px, -200px) scale(1.5); opacity: 0; }
        }

        .love-aura {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255, 133, 161, 0.4) 0%, transparent 70%);
            border-radius: 50%;
            z-index: -1;
            animation: auraPulse 3s ease-in-out infinite;
        }

        @keyframes auraPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.3; }
            50% { transform: translate(-50%, -50%) scale(1.3); opacity: 0.6; }
        }

        .diamond-dust {
            position: fixed;
            width: 2px;
            height: 2px;
            background: white;
            box-shadow: 0 0 5px #fff, 0 0 10px #ffd700;
            border-radius: 50%;
            animation: twinkle 2s ease-in-out infinite;
            z-index: 100002;
            pointer-events: none;
        }

        @keyframes twinkle {
            0%, 100% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.5); opacity: 1; }
        }

        /* Soft Rainbow Overlay */
        body.theme-default .bg-pattern::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, rgba(255,0,0,0.1), rgba(255,165,0,0.1), rgba(255,255,0,0.1), rgba(0,128,0,0.1), rgba(0,0,255,0.1), rgba(75,0,130,0.1), rgba(238,130,238,0.1));
            mix-blend-mode: overlay;
            opacity: 0.6;
            pointer-events: none;
        }

        /* Remove Grain in this Clean Theme */
        body.theme-default .bg-grain {
            display: none;
        }

        @keyframes holoShimmer {
            0% { background-position: 0 0; }
            100% { background-position: 200px 200px; }
        }

        /* Balloon/Floaty Particles */
        .balloon-particle {
            font-size: 1.5rem;
            position: fixed;
            will-change: transform;
            animation: floatUp 10s linear infinite;
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.1));
            z-index: 5;
        }

        @keyframes floatUp {
            0% { transform: translateY(110vh) rotate(-5deg); opacity: 0; }
            10% { opacity: 1; }
            50% { transform: translateY(50vh) rotate(5deg) translateX(20px); }
            100% { transform: translateY(-10vh) rotate(-5deg) translateX(-20px); opacity: 0; }
        }
        
        /* Sparkle Trail (Retained for Magic Touch) */
        .sparkle-trail {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            font-size: 1.2rem;
            animation: fadeOutUp 0.8s forwards;
            filter: drop-shadow(0 0 5px white);
        }
        
        @keyframes fadeOutUp {
            0% { transform: scale(0.5) translateY(0); opacity: 1; }
            100% { transform: scale(1.2) translateY(-20px); opacity: 0; }
        }

        /* Y2K Grain Overlay */
        .bg-grain {
            position: fixed;
            inset: 0;
            z-index: -1;
            opacity: 0.15;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            display: none; /* Only active in default theme */
        }
        body.theme-default .bg-grain { display: block; }

        /* MOOD SHIFT: Bioluminescent Abyss (Ocean) - Super Brightened */
        body.theme-ocean .bg-pattern {
            background: linear-gradient(180deg, #023e8a 0%, #0077b6 100%); /* Vibrant Navy to Azure */
            opacity: 1;
        }
        
        /* Ocean Searchlight Mask */
        .searchlight-mask {
            position: fixed;
            inset: 0;
            z-index: 10;
            background: radial-gradient(circle 300px at var(--x, 50%) var(--y, 50%), transparent 0%, rgba(0,0,0,0.95) 100%);
            pointer-events: none;
            display: none;
        }
        body.theme-ocean .searchlight-mask { display: block; }
        
        /* THEME PARTICLES */
        .theme-particle {
            position: fixed;
            pointer-events: none;
            z-index: 5; /* Above background, below UI */
            will-change: transform;
        }
        
        /* CUTE Kawaii Particles (No Glitch) */
        .cute-particle {
            font-size: 1.5rem;
            animation: softFloat linear infinite;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
        }

        /* Ambient Ocean Life (Visible without searchlight) */
        .ocean-ambient {
            position: fixed;
            pointer-events: none;
            z-index: 1; /* Behind searchlight mask but visible */
            opacity: 0.6; /* Increased visibility */
            animation: swimSlow linear infinite;
            font-size: 2rem;
            filter: blur(0.5px);
        }

        /* Neon Jellyfish/Orbs */
        .neon-bubble {
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(0,255,255,0.8), rgba(0,0,255,0.1));
            box-shadow: 0 0 10px cyan, 0 0 20px blue;
            animation: riseWiggle linear infinite;
            filter: blur(0.5px);
            opacity: 0.6; /* More visible base state */
        }

        @keyframes softFloat {
            0% { transform: translateY(0) rotate(0deg) translateX(0); opacity: 0; }
            5% { opacity: 1; } /* Fade in quickly at top */
            100% { transform: translateY(110vh) rotate(360deg) translateX(-20px); opacity: 0; }
        }
        
        @keyframes swimSlow {
            from { transform: translateX(-10vw) translateY(0) scaleX(-1); }
            to { transform: translateX(110vw) translateY(20px) scaleX(-1); }
        }
        
        @keyframes riseWiggle {
            0% { transform: translateY(110vh) translateX(0); opacity: 0; }
            20% { opacity: 0.8; }
            50% { transform: translateY(50vh) translateX(50px); }
            100% { transform: translateY(-10vh) translateX(-50px); opacity: 0; }
        }

        /* MOOD SHIFT: Cyberpunk Grid */
        body.theme-moonlight .bg-pattern {
            background-image: 
                linear-gradient(rgba(147, 112, 219, 0.3) 1px, transparent 1px),
                linear-gradient(90deg, rgba(147, 112, 219, 0.3) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.2;
            transform: perspective(500px) rotateX(60deg) translateY(-100px) scale(2);
            animation: gridMove 20s linear infinite;
        }

        @keyframes gridMove {
            0% { background-position: 0 0; }
            100% { background-position: 0 500px; }
        }

        /* MOOD SHIFT: Forest Fireflies (replacing Ocean for now if Ocean isn't defined primarily) - actually let's stick to the 3 main ones */
        /* Forest uses default dots but green. */
        


        /* Heart Pop Particle */
        .heart-pop {
            position: fixed;
            pointer-events: none;
            font-size: 20px;
            z-index: 10002;
            animation: popUp 0.8s ease-out forwards;
        }

        @keyframes popUp {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
            100% { transform: translate(-50%, -150%) scale(1.5); opacity: 0; }
        }

        /* Gooey Filter */
        .gooey-filter {
            position: absolute;
            width: 0;
            height: 0;
            visibility: hidden;
        }

        .story-box {
            background: var(--kawaii-cream);
            border: 3px dashed var(--kawaii-pink);
            padding: 20px;
            border-radius: 20px;
            margin-top: 20px;
            font-style: italic;
            font-size: 0.95rem;
            line-height: 1.6;
            display: none;
        }

        .blob {
            position: absolute;
            width: 800px;
            height: 800px;
            border-radius: 50%;
            mix-blend-mode: multiply;
        }

        .blob-1 {
            background: #ffc2d1;
            top: -200px;
            left: -200px;
            filter: brightness(1.2);
        }

        .blob-2 {
            background: #e2f0cb;
            bottom: -200px;
            right: -200px;
            filter: brightness(1.1);
        }

        .blob-3 {
            background: #e0c3fc;
            top: 10%;
            left: 30%;
            width: 1000px;
            height: 1000px;
        }

        /* Ambient Clouds */
        .cloud-bg {
            position: fixed;
            width: 300px;
            height: 120px;
            background: rgba(255, 255, 255, 0.4);
            filter: blur(40px);
            border-radius: 100px;
            z-index: -1;
            pointer-events: none;
        }


        .floating-heart {
            position: fixed;
            pointer-events: none;
            z-index: -1;
            font-size: 24px;
            opacity: 0.6;
            user-select: none;
        }

        .kawaii-box {
            width: 90%;
            max-width: 500px;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 40px;
            border-radius: 40px;
            box-shadow: 
                0 20px 50px rgba(255, 183, 178, 0.3),
                inset 0 0 0 2px rgba(255, 255, 255, 0.5);
            position: relative;
            z-index: 100;
            display: none; /* Initially hidden for bloom */
            opacity: 0;
            transform: scale(0.9) translateY(30px);
            filter: blur(10px);
            overflow: hidden;
            animation: boxGlow 8s infinite alternate ease-in-out;
            transform-style: preserve-3d;
            will-change: transform;
        }

        .kawaii-box::before {
            content: '';
            position: absolute;
            top: -100%;
            left: -100%;
            width: 300%;
            height: 300%;
            background: var(--holographic);
            transform: rotate(30deg);
            pointer-events: none;
            z-index: 1;
            opacity: 0.3;
            animation: holoFlow 8s infinite linear;
        }

        @keyframes holoFlow {
            0% { transform: translate(-50%, -50%) rotate(30deg); }
            100% { transform: translate(50%, 50%) rotate(30deg); }
        }

        @keyframes boxGlow {
            from {
                border-color: var(--kawaii-pink);
                box-shadow: 0 40px 100px rgba(255, 133, 161, 0.2);
            }

            to {
                border-color: var(--kawaii-lavender);
                box-shadow: 0 40px 120px rgba(224, 195, 252, 0.3);
            }
        }

        .kawaii-box::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            animation: shine 10s infinite;
            pointer-events: none;
        }

        @keyframes shine {
            0% {
                transform: translateX(-100%) rotate(45deg);
            }

            100% {
                transform: translateX(100%) rotate(45deg);
            }
        }

        .logo-area {
            font-size: 3.5rem;
            margin-bottom: 10px;
            display: inline-block;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            user-select: none;
        }

        .logo-area:hover {
            transform: scale(1.2) rotate(10deg);
        }

        .floating-vibe {
            position: absolute;
            font-size: 3.5rem;
            filter: drop-shadow(0 10px 20px rgba(255, 133, 161, 0.3));
            animation: vibeFloat 4s ease-in-out infinite alternate;
            user-select: none;
            z-index: 12;
        }

        /* Ambient Petals */
        .ambient-container {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .petal {
            position: absolute;
            background: var(--kawaii-pink);
            border-radius: 150% 0 150% 0;
            opacity: 0.4;
            animation: fall linear infinite;
        }

        @keyframes fall {
            0% { transform: translateY(-10vh) rotate(0deg); }
            100% { transform: translateY(110vh) rotate(360deg); }
        }

        /* Ambient Effects */
        .bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            pointer-events: none;
            animation: rise linear infinite;
        }

        @keyframes rise {
            0% { transform: translateY(110vh) scale(1); opacity: 0; }
            50% { opacity: 0.6; }
            100% { transform: translateY(-10vh) scale(1.5); opacity: 0; }
        }

        .firefly {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #e9edc9;
            border-radius: 50%;
            box-shadow: 0 0 10px #e9edc9;
            pointer-events: none;
            animation: drift ease-in-out infinite;
        }

        @keyframes drift {
            0%, 100% { transform: translate(0, 0); opacity: 0; }
            50% { transform: translate(100px, -100px); opacity: 0.8; }
        }

        .visualizer {
            display: flex;
            align-items: flex-end;
            gap: 2px;
            height: 20px;
            margin-right: 5px;
        }

        .vis-bar {
            width: 3px;
            height: 5px;
            background: var(--kawaii-pink-dark);
            border-radius: 2px;
            animation: pulse-vis 0.5s ease-in-out infinite alternate;
        }

        @keyframes pulse-vis {
            0% { height: 5px; }
            100% { height: 20px; }
        }

        @keyframes vibeFloat {
            0% {
                transform: translateY(0) rotate(-10deg) scale(1);
            }

            100% {
                transform: translateY(-30px) rotate(10deg) scale(1.1);
            }
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 2.2rem;
            color: var(--kawaii-pink-dark);
            margin-bottom: 5px;
            letter-spacing: -0.5px;
        }

        .subtitle {
            font-size: 1rem;
            color: var(--kawaii-text);
            opacity: 0.7;
        }

        .progress-track {
            width: 100%;
            height: 14px;
            background: #fdf0f3;
            border-radius: 20px;
            margin-bottom: 40px;
            overflow: hidden;
            border: 3px solid var(--kawaii-white);
        }

        .progress-fill {
            width: 25%;
            height: 100%;
            background: var(--kawaii-pink-dark);
            border-radius: 20px;
            transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .steps {
            position: relative;
            min-height: 480px;
        }

        .step {
            display: none;
            flex-direction: column;
            animation: popIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .step.active {
            display: flex;
        }

        @keyframes popIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            font-weight: 800;
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--kawaii-pink-dark);
        }

        input[type="text"],
        input[type="email"],
        input[type="number"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 22px 30px;
            background: rgba(255, 255, 255, 0.6);
            border: 5px solid var(--kawaii-pink);
            border-radius: 30px;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--kawaii-text);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            outline: none;
            backdrop-filter: blur(5px);
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: var(--kawaii-pink-dark);
            background: var(--kawaii-white);
            box-shadow: 0 15px 35px rgba(255, 133, 161, 0.25);
            transform: translateY(-5px) scale(1.02);
        }

        .chips {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .chip {
            padding: 10px 20px;
            background: var(--kawaii-cream);
            border: 2px solid var(--kawaii-pink);
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            user-select: none;
        }

        .chip:hover {
            transform: translateY(-3px);
            border-color: var(--kawaii-pink-dark);
        }

        .chip.selected {
            background: var(--kawaii-pink-dark);
            color: white;
            border-color: var(--kawaii-pink-dark);
            box-shadow: 0 5px 15px rgba(255, 133, 161, 0.3);
        }

        .range-container {
            padding: 10px 0;
        }

        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            background: transparent;
        }

        input[type=range]::-webkit-slider-runnable-track {
            height: 10px;
            background: var(--kawaii-mint);
            border-radius: 5px;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            height: 25px;
            width: 25px;
            background: var(--kawaii-pink-dark);
            border-radius: 50%;
            margin-top: -8px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 18px;
            border-radius: 25px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            border: none;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .btn-next {
            background: var(--kawaii-pink-dark);
            color: white;
            box-shadow: 0 10px 0 #cc6981;
        }

        .btn-next:hover {
            transform: translateY(-3px);
            box-shadow: 0 13px 0 #cc6981;
        }

        .btn-next:active {
            transform: translateY(7px);
            box-shadow: 0 3px 0 #cc6981;
        }

        .btn-back {
            background: var(--kawaii-mint);
            color: var(--kawaii-text);
            box-shadow: 0 10px 0 #b3c299;
        }

        .reveal-card {
            display: none;
            text-align: center;
        }

        .match-avatar {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            border: 8px solid var(--kawaii-pink);
            margin: 0 auto 30px;
            overflow: hidden;
            background: var(--kawaii-cream);
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 0.3s ease;
        }

        .match-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .match-name {
            font-size: 2.5rem;
            color: var(--kawaii-pink-dark);
            margin-bottom: 15px;
        }

        .sparkles {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        .swipe-container {
            position: relative;
            width: 100%;
            height: 450px;
            margin: 20px 0;
            perspective: 1000px;
        }

        .swipe-card {
            position: absolute;
            width: 100%;
            height: 100%;
            background: var(--kawaii-white);
            border-radius: 35px;
            border: 4px solid var(--kawaii-pink);
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(255, 133, 161, 0.15);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s;
            cursor: grab;
            display: flex;
            flex-direction: column;
            transform-origin: center bottom;
        }

        .swipe-card:active {
            cursor: grabbing;
        }

        .swipe-card-img {
            width: 100%;
            height: 65%;
            object-fit: cover;
            border-bottom: 4px solid var(--kawaii-pink);
        }

        .swipe-card-info {
            padding: 20px;
            text-align: left;
            background: linear-gradient(to bottom, #ffffff, #fffafa);
            flex-grow: 1;
        }

        .swipe-card-name {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--kawaii-pink-dark);
            margin-bottom: 5px;
        }

        .swipe-card-bio {
            font-size: 0.9rem;
            opacity: 0.8;
            line-height: 1.4;
            margin-bottom: 10px;
        }

        .card-tags {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .card-tag {
            font-size: 0.7rem;
            padding: 3px 8px;
            background: var(--kawaii-pink);
            color: white;
            border-radius: 10px;
            font-weight: 700;
        }

        .swipe-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }

        .swipe-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            border: none;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
        }

        .btn-nope {
            background: #fee2e2;
            color: #ef4444;
        }

        .btn-like {
            background: #dcfce7;
            color: #22c55e;
        }

        .stamp {
            position: absolute;
            top: 20px;
            padding: 5px 15px;
            border: 5px solid;
            border-radius: 10px;
            font-size: 2rem;
            font-weight: 900;
            text-transform: uppercase;
            opacity: 0;
            z-index: 20;
            pointer-events: none;
        }

        .stamp-like {
            color: #22c55e;
            border-color: #22c55e;
            left: 20px;
            transform: rotate(-15deg);
        }

        .stamp-nope {
            color: #ef4444;
            border-color: #ef4444;
            right: 20px;
            transform: rotate(15deg);
        }

        .kawaii-loader {
            position: absolute;
            inset: 0;
            background: var(--kawaii-white);
            border-radius: 50px;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .kawaii-loader.active {
            display: flex;
        }

        .bouncing-heart {
            font-size: 4rem;
            animation: bounce 0.6s infinite alternate;
        }

        @keyframes bounce {
            from {
                transform: translateY(0) scale(1.1);
            }

            to {
                transform: translateY(-30px) scale(0.9);
            }
        }

        .smart-suggester {
            position: absolute;
            top: 20px;
            right: -260px;
            width: 220px;
            background: var(--kawaii-cream);
            border: 4px solid var(--kawaii-white);
            border-radius: 30px;
            padding: 20px;
            box-shadow: 0 15px 30px rgba(255, 133, 161, 0.1);
            animation: float 4s ease-in-out infinite;
            z-index: 100;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .suggestion-header {
            font-size: 0.8rem;
            font-weight: 800;
            color: var(--kawaii-pink-dark);
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .suggestion-content {
            font-size: 0.9rem;
            line-height: 1.4;
            color: var(--kawaii-text);
            font-style: italic;
        }

        .love-bar {
            width: 100%;
            height: 8px;
            background: #fdf0f3;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 15px;
        }

        .love-bar-fill {
            width: 10%;
            height: 100%;
            background: linear-gradient(90deg, #ffc2d1, #ff85a1);
            transition: width 0.8s ease;
        }

        @media (max-width: 1100px) {
            .smart-suggester {
                position: static;
                width: 100%;
                margin-top: 25px;
                right: 0;
            }
        }

        /* Lofi Radio */
        .lofi-radio {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            padding: 10px 15px;
            border-radius: 30px;
            border: 3px solid var(--kawaii-pink);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            box-shadow: 0 10px 20px rgba(255, 133, 161, 0.2);
            transition: all 0.3s ease;
        }

        .lofi-radio:hover {
            transform: scale(1.05);
        }

        .radio-btn {
            background: var(--kawaii-pink-dark);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }

        .radio-btn:hover {
            transform: scale(1.2) rotate(10deg);
        }

        .song-marquee {
            width: 100px;
            overflow: hidden;
            white-space: nowrap;
            font-size: 0.7rem;
            color: var(--kawaii-text);
            font-weight: 700;
            position: relative;
        }

        .song-text {
            display: inline-block;
            padding-left: 100%;
            animation: marquee 10s linear infinite;
        }

        @keyframes marquee {
            0% { transform: translate(0, 0); }
            100% { transform: translate(-100%, 0); }
        }

        /* Chat Simulator */
        .chat-sim {
            background: white;
            border-radius: 20px;
            border: 3px solid var(--kawaii-pink);
            margin-top: 20px;
            text-align: left;
            overflow: hidden;
            display: none;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateY(20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .chat-header {
            background: var(--kawaii-pink);
            padding: 10px;
            font-weight: 800;
            font-size: 0.8rem;
        }

        .chat-msg {
            padding: 15px;
            font-size: 0.9rem;
            background: var(--kawaii-cream);
            border-radius: 15px;
            margin: 10px;
            display: inline-block;
            position: relative;
        }

        .img-preview {
            width: 100%;
            max-width: 200px;
            margin-top: 10px;
            border-radius: 15px;
            border: 3px solid var(--kawaii-pink);
            display: none;
            object-fit: cover;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            animation: popIn 0.5s ease;
        }

        @keyframes blink {
            50% {
                opacity: 0;
            }
        }

        /* Date Compass */
        .date-compass {
            background: var(--kawaii-mint);
            padding: 15px;
            border-radius: 20px;
            margin-top: 20px;
            border: 3px solid white;
            display: none;
        }

        .compass-title {
            font-weight: 800;
            color: #6b4e71;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .compass-suggestion {
            font-size: 0.85rem;
            font-style: italic;
        }

        /* Badge Styling */
        /* Theme Slider */
        .theme-slider {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(10px);
            padding: 5px;
            border-radius: 50px;
            display: flex;
            border: 2px solid var(--kawaii-pink);
            z-index: 10001;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .theme-btn {
            border: none;
            background: transparent;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            z-index: 2;
            color: var(--kawaii-text);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .theme-btn:hover {
            background: rgba(255,255,255,0.5);
        }

        .theme-btn.active {
            background: var(--kawaii-pink-dark);
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: scale(1.1);
        }
        /* Lightbox */
        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 300000;
            display: none;
            justify-content: center;
            align-items: center;
            cursor: zoom-out;
            animation: fadeIn 0.3s ease;
        }

        .lightbox img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(255,192,203, 0.5);
            transform: scale(0.9);
            transition: transform 0.3s;
        }

        .lightbox.active {
            display: flex;
        }
        
        .lightbox.active img {
            transform: scale(1);
        }

        
        body.theme-moonlight .swipe-card-bio {
            color: #555 !important;
        }

        body.theme-moonlight .date-compass, 
        body.theme-moonlight .story-box {
            color: #333 !important;
        }

        body.theme-moonlight .compass-title {
            color: var(--kawaii-pink-dark) !important;
        }
        
        body.theme-moonlight .compass-suggestion {
             color: #555 !important;
        }

        /* Match Score Badge */
        .match-score {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            padding: 5px 15px;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 800;
            color: var(--kawaii-pink-dark);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        /* --- MOBILE RESPONSIVENESS --- */
        @media (max-width: 768px) {
            .kawaii-box {
                width: 95%;
                padding: 25px 20px;
            }
            
            .enter-overlay h1 {
                font-size: 3.5rem !important;
                line-height: 1.2;
            }
            
            .logo-area {
                font-size: 2.5rem;
            }

            .mascot-container img {
                width: 200px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
                align-items: flex-start; /* Parse content better */
            }

            h1 {
                font-size: 1.8rem;
            }
            
            .enter-overlay h1 {
                font-size: 2.8rem !important;
                margin-top: -50px;
            }
            
            .enter-btn {
                padding: 15px 40px;
                font-size: 1.2rem;
                width: 90%;
            }
            
            .kawaii-box {
                margin-top: 60px; /* Space for mood switcher */
                padding: 20px 15px;
            }

            /* Better form elements for touch */
            input, select, textarea {
                font-size: 16px !important; /* Prevents iOS zoom */
                padding: 14px 15px;
            }
            
            .group {
                margin-bottom: 20px;
            }

            /* Stack chips on mobile */
            .chips {
                gap: 5px;
            }
            
            .chip {
                padding: 8px 12px;
                font-size: 0.9rem;
                flex: 1 1 auto;
                text-align: center;
            }
            
            /* Clean up UI clutter */
            .floating-vibe { opacity: 0.5; transform: scale(0.6); }
            .blob { opacity: 0.4; }
            
            /* Reposition Controls */
            #moodSwitcher {
                left: 50%;
                transform: translateX(-50%);
                top: 15px;
                width: auto;
                justify-content: center;
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255,255,255,0.6);
            }

            #audioControls {
                top: auto;
                bottom: 20px;
                right: 20px;
                transform: scale(0.9);
            }
        }
    </style>
</head>

<body>
    <div class="enter-overlay" id="enterOverlay">
        <div class="cinematic-vignette"></div>
        <div class="neon-border"></div>
        <div class="central-plate"></div>
        <div class="satin-overlay"></div>
        <div class="love-aura"></div>

        <!-- Decorative Ribbons -->
        <div class="ribbon-float" style="top: 20%; left: 10%; animation-delay: 0s;"></div>
        <div class="ribbon-float" style="top: 70%; left: 80%; animation-delay: 2s;"></div>
        <div class="ribbon-float" style="top: 40%; left: 90%; animation-delay: 4s;"></div>
        
        <div class="mascot-container">
            <img src="assets/mascot.png">
        </div>
        <h1>Kawaii Heart Finder</h1>
        
        <!-- MOBILE WARNING OVERLAY -->
        <div id="mobileWarning" style="display:none; position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); background:rgba(0,0,0,0.85); color:white; padding:30px; border-radius:30px; z-index:99999; width:90%; text-align:center; border: 2px solid var(--kawaii-pink);">
            <h2 style="color:var(--kawaii-pink); margin-bottom:15px; font-size:1.8rem;"> Mobile Detected!</h2>
            <p style="margin-bottom:20px; font-size:1rem; line-height:1.5;">This magical world is <b>heavily animated</b> and looks best on a big screen (Laptop/Desktop). <br><br>On mobile, it might lag or look squeezed.</p>
            <button class="enter-btn" style="padding:15px 30px; font-size:1rem;" onclick="enableLiteMode()">Continue in Lite Mode </button>
        </div>

        <div id="entryButtons">
            <button class="enter-btn" onclick="startApp()">Enter the Magic </button>
            <button class="enter-btn" style="background: rgba(255,255,255,0.8); color: #ff1a7d; border: 2px solid #ff1a7d; margin-top: 15px;" onclick="showLogin()">Welcome Back </button>
        </div>

        <div id="loginGate" style="display:none; text-align: center;">
            <input type="email" id="loginEmail" placeholder="Your Email..." style="padding: 12px 20px; border-radius: 50px; border: 2px solid var(--kawaii-pink); width: 250px; margin-bottom: 15px; outline: none;">
            <br>
            <button class="enter-btn" onclick="doLogin()">Unlock Destiny </button>
            <p onclick="showEntry()" style="font-size: 0.8rem; margin-top: 15px; cursor: pointer; color: var(--kawaii-pink-dark); text-decoration: underline;">Wait, I'm new! </p>
        </div>
    </div>
    </div>

    <div id="lightbox" class="lightbox" onclick="closeLightbox()">
        <img id="lightboxImg" src="">
    </div>



    <div class="bg-blobs">
        <div class="blob blob-1" id="blob1"></div>
        <div class="blob blob-2" id="blob2"></div>
        <div class="blob blob-3" id="blob3"></div>
    </div>
    <div class="bg-pattern"></div>
    <div class="bg-grain"></div>      <!-- Y2K Grain -->
    <div class="sun-bg"></div>     <!-- Sun (Living Sky) -->
    <div class="searchlight-mask"></div> <!-- Ocean Searchlight -->
    
    <!-- STARDUST SCREEN (Self-Destruct UI) -->
    <div id="stardustScreen" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:black; z-index:999999; align-items:center; justify-content:center; flex-direction:column; color:white; text-align:center;">
        <h1 style="font-size: 4rem; text-shadow: 0 0 20px #fff;"> Mission Complete</h1>
        <p style="font-size: 1.5rem; margin-top: 20px; opacity: 0.8;">Our time together has turned into stardust.</p>
        <p style="font-size: 1rem; margin-top: 10px; color: var(--kawaii-pink);">See you in another timeline... </p>
        <div style="font-size: 5rem; margin-top: 40px; animation: float 3s infinite ease-in-out;"></div>
    </div>
    
    <!-- Mood Switcher -->
    <!-- Mood Switcher (Polished) -->
    <div id="moodSwitcher" style="position: fixed; top: 20px; left: 20px; z-index: 20000; display: flex; gap: 8px; 
        background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px); padding: 8px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.4); box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
        <button class="theme-btn" onclick="setMood('default')" title="Kawaii Default" style="width: 35px; height: 35px; border-radius: 50%; padding: 0; font-size: 1.1rem; border:none; background:rgba(255,255,255,0.5);"></button>
        <button class="theme-btn" onclick="setMood('theme-ocean')" title="Ocean Breeze" style="width: 35px; height: 35px; border-radius: 50%; padding: 0; font-size: 1.1rem; border:none; background: #bde0fe;"></button>
        <button class="theme-btn" onclick="setMood('theme-moonlight')" title="Moonlight & Neon" style="width: 35px; height: 35px; border-radius: 50%; padding: 0; font-size: 1.1rem; border:none; background: #483d8b;"></button>
    </div>
    
    <!-- Audio Controls -->
    <div id="audioControls" style="position: fixed; top: 10px; right: 10px; z-index: 20000; cursor: pointer; transition: transform 0.3s ease;">
        <button id="musicBtn" class="theme-btn" style="width: auto; height: 40px; border-radius: 20px; font-size: 1rem; padding: 0 15px; display: flex; align-items: center; gap: 8px;">
            <span id="musicIcon"></span> <span id="musicText">Play Lo-Fi</span>
        </button>
        <audio id="bgMusic" loop>
            <source src="https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=lofi-study-112778.mp3" type="audio/mpeg">
        </audio>
    </div>



    <div id="heart-rain"></div>

    <div id="ambientOverlay" class="ambient-container"></div>
    <canvas id="sparkleCanvas"></canvas>

    <!-- Gooey Filter -->
    <svg class="gooey-filter">
        <defs>
            <filter id="gooey">
                <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur" />
                <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7" result="gooey" />
                <feComposite in="SourceGraphic" in2="gooey" operator="atop" />
            </filter>
        </defs>
    </svg>



    <div class="kawaii-box" id="mainBox">
        <div class="decorations">
            <div class="floating-vibe" style="top: -60px; right: -30px; animation-delay: 0s;"></div>
            <div class="floating-vibe" style="bottom: -50px; left: -30px; animation-delay: -2s;"></div>
            <div class="floating-vibe" style="top: 30%; left: -70px; animation-delay: -1s;"></div>
            <div class="floating-vibe" style="bottom: 30%; right: -70px; animation-delay: -3s;"></div>
        </div>

        <div class="kawaii-loader" id="loader">
            <img src="assets/mascot.png" 
                 style="width: 120px; border-radius: 50%; box-shadow: 0 0 20px rgba(255,194,209,0.5); animation: bounce 0.6s infinite alternate;">
            <p style="margin-top: 20px; font-weight:700;">Finding Your Perfect Choice...</p>
        </div>

        <div class="smart-suggester" id="suggester">
            <div class="suggestion-header"> Magic Suggestion</div>
            <div class="suggestion-content" id="suggestionText">"Tell me your name so I can start matching your energy!"
            </div>
            <div class="love-bar">
                <div class="love-bar-fill" id="loveFill"></div>
            </div>
        </div>

        <div id="formContainer">
            <header>
                <div class="logo-area" id="mainMascot" onclick="mascotBoop()">
                    <img src="assets/mascot.png" 
                         style="width: 60px; height: 60px; border-radius: 50%;">
                </div>
                <h1>Kawaii Heart Finder</h1>
                <p class="subtitle">Ultimate Aesthetic Match Engine </p>
            </header>

            <div class="progress-track">
                <div class="progress-fill" id="progress"></div>
            </div>

            <form id="kawaiiForm">
                <div class="steps">
                    <div class="step active" id="step1">
                        <div class="group"><label>What's your name, cutie?  <span style="color:red">*</span></label><input type="text" id="name"
                                placeholder="E.g. Sakura-chan" required oninput="updateSuggestions()"></div>
                        <div class="group"><label>Email Address  <span style="color:red">*</span></label><input type="email" id="email"
                                placeholder="hello@kawaii.com" required oninput="updateSuggestions()"></div>
                        <div class="group"><label>Age  <span style="color:red">*</span></label><input type="number" id="age"
                                min="18" placeholder="21" required oninput="updateSuggestions()"></div>
                        
                        <!-- NEW GENDER OPTIONS -->
                        <div class="group">
                            <label>I am...  <span style="color:red">*</span></label>
                            <select id="gender" required>
                                <option value="Female">Female </option>
                                <option value="Male">Male </option>
                                <option value="Non-binary">Non-binary </option>
                            </select>
                        </div>
                         <div class="group">
                            <label>Looking for...  <span style="color:red">*</span></label>
                            <select id="interestedIn" required>
                                <option value="Male">Men </option>
                                <option value="Female">Women </option>
                                <option value="Everyone">Everyone </option>
                            </select>
                        </div>

                        <div class="group"><label>Special Day (DOB)  (Optional)</label><input type="date" id="dob">
                        </div>
                    </div>

                    <div class="step" id="step2">
                        <div class="group"><label>Distance Preference (km) </label>
                            <div class="range-container">
                                <input type="range" id="distance" min="1" max="100" value="25"
                                    oninput="this.nextElementSibling.value = this.value + ' km'">
                                <output style="font-weight:700; color:var(--kawaii-pink-dark);">25 km</output>
                            </div>
                        </div>
                        <div class="group"><label>Pick your Vibes! (Interests) </label>
                            <div class="chips" id="interestChips">
                                <div class="chip" onclick="toggleChip(this)">Painting </div>
                                <div class="chip" onclick="toggleChip(this)">Gaming </div>
                                <div class="chip" onclick="toggleChip(this)">Anime </div>
                                <div class="chip" onclick="toggleChip(this)">Coffee </div>
                                <div class="chip" onclick="toggleChip(this)">Hiking </div>
                                <div class="chip" onclick="toggleChip(this)">Astrology </div>
                                <div class="chip" onclick="toggleChip(this)">Music </div>
                                <div class="chip" onclick="toggleChip(this)">K-Pop </div>
                                <div class="chip" onclick="toggleChip(this)">Coding </div>
                                <div class="chip" onclick="toggleChip(this)">Cats </div>
                                <div class="chip" onclick="toggleChip(this)">Traveling </div>
                                <div class="chip" onclick="toggleChip(this)">Foodie </div>
                                <div class="chip" onclick="toggleChip(this)">Photography </div>
                                <div class="chip" onclick="toggleChip(this)">Reading </div>
                            </div>
                        </div>
                    </div>

                    <div class="step" id="step3">
                        <div class="group"><label>Your Heart's Desire </label>
                            <select id="relType">
                                <option>Long-term Love Story </option>
                                <option>Bestie for Life </option>
                                <option>Cute Connection </option>
                            </select>
                        </div>
                        <div class="group"><label>Upload your cute face!  <span style="color:red">*</span></label>
                            <input type="file" id="photos" accept="image/*" required>
                            <img id="photosPreview" class="img-preview" onclick="openLightbox(this.src)" title="Click to Maximize ">
                        </div>
                        <div class="group"><label>Upload Social QR / Contact Info  <span style="color:red">*</span></label>
                            <input type="file" id="socialQr" accept="image/*" required>
                            <img id="socialQrPreview" class="img-preview" onclick="openLightbox(this.src)" title="Click to Maximize ">
                            <p style="font-size: 0.8rem; margin-top: 5px; opacity: 0.7;">Upload your Insta/Snap/X QR code so your match can find you!</p>
                        </div>
                    </div>

                    <div class="step" id="step4">
                        <div class="group"><label>Anything else for your match?  (Optional)</label><textarea id="extra" rows="4"
                                placeholder="Tell them something sweet..."></textarea></div>

                        <div class="group" style="text-align: center;">
                            <label>Secure Premium Match? (Optional) </label>
                            <img src="assets/premium_qr.jpg"
                                style="border-radius: 20px; border: 5px solid var(--kawaii-pink); width: 220px;">
                            <p style="font-size: 0.8rem; margin-top: 10px; opacity: 0.6;">Scan to unlock 2x match
                                accuracy!</p>
                        </div>
                    </div>
                </div>

                <div class="controls">
                    <button type="button" class="btn btn-back" id="backBtn" onclick="prevStep()"
                        style="display:none;">Back</button>
                    <button type="button" class="btn btn-next" id="nextBtn" onclick="nextStep()">Continue </button>
                </div>
                
                <div style="margin-top: 20px; text-align: center; opacity: 0.8; font-size: 0.75rem; color: var(--kawaii-text);">
                    <p> <strong>100% Secure & Private</strong><br>
                    Your data is encrypted and only used to find your perfect match.<br>
                    <strong> Self-Destruct Enabled:</strong> This website and ALL data will be automatically<br>
                    permanently deleted after Feb 14th. No traces left behind! </p>
                </div>
            </form>
        </div>

        <div class="reveal-card" id="revealScreen" style="padding-top: 20px;">
            <div class="sparkles" id="sparkles"></div>
            <p style="font-size: 1.2rem; margin-bottom: 10px; font-weight:800; color: var(--kawaii-pink-dark);"> Your
                Vibe List is Ready!</p>
            <div class="swipe-container" id="swipeDeck"></div>
            <div class="swipe-buttons">
                <button class="swipe-btn btn-nope" onclick="forceSwipe('left')"></button>
                <button class="swipe-btn btn-like" onclick="forceSwipe('right')"></button>
            </div>
            <p id="deckCounter" style="margin-top: 20px; font-size: 0.8rem; font-weight: 700; opacity: 0.5;">5 matches
                remaining</p>

            <div id="finalMatchCelebration" style="display:none; margin-top: 30px;">
                <div class="final-match-card" style="transform-origin: center center;">
                    <div id="personalityBadge" class="badge">Matcha Queen</div>
                    <h2 style="color:var(--kawaii-pink-dark); margin-bottom: 15px;">It's a Mega Match! </h2>
                    <div class="match-avatar">
                        <img id="finalMatchImg" src="" alt="The One">
                    </div>
                    <h3 id="finalMatchName">Soulmate</h3>

                <div id="userShowcase" style="display:flex; justify-content:center; gap:20px; margin-top:20px; flex-wrap:wrap;"></div>

                <div id="extrasContainer"></div>
                </div> <!-- End .final-match-card -->

                <div class="date-compass" id="dateCompass">
                    <div class="compass-title"> Magic Date Compass:</div>
                    <div class="compass-suggestion" id="dateSuggestion">How about a cozy Cat Cafe Chill? </div>
                </div>

                <div class="date-compass" id="luckyHoroscope"
                    style="background: var(--kawaii-lavender); display: none;">
                    <div class="compass-title"> Your Daily Love Luck:</div>
                    <div class="compass-suggestion" id="horoscopeText">Your aura is glowing! 95% Compatibility!</div>
                </div>

                <div style="margin-top:20px;">
                    <button class="btn btn-next" onclick="location.reload()" style="width:100%;">Reset Magic </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Warning Overlay -->
    <div id="mobileWarning" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.95); z-index: 1000; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; box-sizing: border-box;">
        <img src="assets/mascot.png" style="width: 100px; height: 100px; border-radius: 50%; margin-bottom: 20px;">
        <h2 style="color: var(--kawaii-pink-dark); margin-bottom: 15px;"> Oh no, cutie! </h2>
        <p style="font-size: 1.1rem; color: var(--kawaii-text); margin-bottom: 20px;">
            This experience is best viewed on a desktop or laptop for full sparkle! <br>
            Some animations and effects might be disabled on mobile to keep things smooth.
        </p>
        <button class="btn btn-next" onclick="enableLiteMode()" style="width: auto; padding: 10px 30px;">Continue Anyway! </button>
    </div>

    <script>
        // --- 10/10 PRO DEPLOYMENT CONFIG ---
        // Change this to your Glitch/Production URL when deploying!
        
        // --- MOBILE & PERFORMANCE LOGIC ---
        let isLiteMode = false;

        function checkMobile() {
            if (window.innerWidth <= 768) {
                // Show Warning
                document.getElementById('mobileWarning').style.display = 'block';
                // Hide entry buttons until user decides
                const entryButtons = document.getElementById('entryButtons');
                if (entryButtons) entryButtons.style.display = 'none';
            }
        }

        function enableLiteMode() {
            isLiteMode = true;
            document.getElementById('mobileWarning').style.display = 'none';
            const entryButtons = document.getElementById('entryButtons');
            if (entryButtons) entryButtons.style.display = 'flex'; // Show buttons
            
            // Disable heavy effects
            const bgBlobs = document.querySelector('.bg-blobs');
            if (bgBlobs) bgBlobs.style.display = 'none';
            const gooeyFilter = document.querySelector('.gooey-filter');
            if (gooeyFilter) gooeyFilter.style.display = 'none';
            const sparkleCanvas = document.getElementById('sparkleCanvas');
            if (sparkleCanvas) sparkleCanvas.style.display = 'none'; // Stop particles
        }

        // Run check on load
        window.onload = checkMobile;


        function setTheme(theme, btn) {
            document.body.className = theme === 'default' ? '' : 'theme-' + theme;
            localStorage.setItem('kawaii-theme', theme);
            
            // Update active button state
            document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');
            
            gsap.from(".kawaii-box", { scale: 0.95, duration: 0.5, ease: "back.out(2)" });
            updateAmbientEffects(theme);
        }

        /* ... Ambient Functions ... */

        function openLightbox(src) {
            if(!src) return;
            const lb = document.getElementById('lightbox');
            const img = document.getElementById('lightboxImg');
            img.src = src;
            lb.classList.add('active');
        }

        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('active');
        }

        // --- HIGH-END CANVAS SPARKLE SYSTEM ---
        const canvas = document.getElementById('sparkleCanvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        
        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        class Particle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.size = Math.random() * 8 + 2;
                this.speedX = (Math.random() - 0.5) * 5;
                this.speedY = (Math.random() - 0.5) * 5;
                // Kawaii Hues (Pink to Lavender)
                this.color = `hsla(${Math.random() * 60 + 320}, 100%, 85%, ${Math.random() * 0.8 + 0.2})`;
                this.life = 1;
                this.decay = Math.random() * 0.02 + 0.01;
            }
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.life -= this.decay;
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.shadowBlur = 10;
                ctx.shadowColor = this.color;
                ctx.globalAlpha = this.life;
                ctx.beginPath();
                // Draw 4-pointed star
                const spikes = 4;
                const outer = this.size;
                const inner = this.size / 2;
                let rot = Math.PI / 2 * 3;
                let x = this.x;
                let y = this.y;
                let step = Math.PI / spikes;

                ctx.moveTo(this.x, this.y - outer);
                for (let i = 0; i < spikes; i++) {
                    x = this.x + Math.cos(rot) * outer;
                    y = this.y + Math.sin(rot) * outer;
                    ctx.lineTo(x, y);
                    rot += step;

                    x = this.x + Math.cos(rot) * inner;
                    y = this.y + Math.sin(rot) * inner;
                    ctx.lineTo(x, y);
                    rot += step;
                }
                ctx.lineTo(this.x, this.y - outer);
                ctx.closePath();
                ctx.fill();
            }
        }

        function animateParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < particles.length; i++) {
                particles[i].update();
                particles[i].draw();
                if (particles[i].life <= 0) {
                    particles.splice(i, 1);
                    i--;
                }
            }
            requestAnimationFrame(animateParticles);
        }
        animateParticles();

        // Note: Mouse particles removed as requested


        window.addEventListener('mousedown', (e) => {
            for(let i=0; i<15; i++) {
                particles.push(new Particle(e.clientX, e.clientY));
            }
        });



        function mascotBoop() {
            const mascot = document.getElementById('mainMascot');
            gsap.to(mascot, {
                scale: 1.5,
                rotation: gsap.utils.random(-20, 20),
                duration: 0.3,
                ease: "back.out(3)",
                onComplete: () => gsap.to(mascot, { scale: 1, rotation: 0, duration: 0.5 })
            });
            typeMessage(["Phew! That tickles! ", "Hehe! Boop! ", "You're so sweet! "][Math.floor(Math.random() * 3)]);
        }

        function startApp() {
            // Stop Valentine Dream Intervals
            clearInterval(bokehInterval);
            clearInterval(dustInterval);
            document.querySelectorAll('.bokeh-heart, .diamond-dust').forEach(h => h.remove());

            // New Exit Animation
            const overlay = document.getElementById('enterOverlay');
            overlay.classList.add('zoom-exit');
            
            // Wait for animation to finish before hiding completely
            setTimeout(() => {
                overlay.classList.add('hidden');
                
                // Show Main App with a bounce
                const app = document.getElementById('app');
                app.style.display = 'block';
                gsap.from("#app", { scale: 0.8, opacity: 0, duration: 1, ease: "elastic.out(1, 0.5)" });
                
                // Start Particles
                setMood('default');
            }, 600); // Match CSS transition timing
        }

        function showLogin() {
            document.getElementById('entryButtons').style.display = 'none';
            document.getElementById('loginGate').style.display = 'block';
        }

        function showEntry() {
            document.getElementById('loginGate').style.display = 'none';
            document.getElementById('entryButtons').style.display = 'block';
        }

        async function doLogin() {
            const email = document.getElementById('loginEmail').value;
            if(!email) return showSafetyAlert("Please enter your email, cutie!");

            // Show loader
            document.getElementById('loader').classList.add('active');
            document.querySelector('#loader p').innerText = "Finding your soul history...";

            try {
                // Use the new /api/login endpoint with API_BASE
                const res = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 'email': email })
                });
                const data = await res.json();
                
                if(data.success) {
                    currentUser = data.user;
                    startApp(); // Trigger zoom animation
                    
                    // Fetch real matches from the server
                    const mRes = await fetch(`${API_BASE}/matches?userId=${currentUser.id}`);
                    const mData = await mRes.json();
                    
                    setTimeout(() => {
                        document.getElementById('kawaiiForm').style.display = 'none';
                        document.getElementById('revealScreen').style.display = 'block';
                        renderDeck(mData.matches || []); // Real users only
                        document.getElementById('loader').classList.remove('active');
                    }, 800);
                } else {
                    showSafetyAlert("We couldn't find you! Try creating a new profile? ");
                    document.getElementById('loader').classList.remove('active');
                }
            } catch(e) { 
                console.error("Login Error:", e);
                showSafetyAlert("Server connection failed! Please check your network. ");
                document.getElementById('loader').classList.remove('active');
            }
        }

        function playSound(type) {
            return; // Sound disabled
        }

        function updateAmbientEffects(theme) {
            const container = document.getElementById('ambientOverlay');
            container.innerHTML = '';
            if (theme === 'ocean') createBubbles();
            else if (theme === 'forest') createFireflies();
            else if (theme === 'moonlight') createStars();
            else createPetals();
        }

        function createBubbles() {
            const container = document.getElementById('ambientOverlay');
            for(let i=0; i<30; i++) {
                const b = document.createElement('div');
                b.className = 'bubble';
                const size = Math.random() * 20 + 5;
                b.style.width = size + 'px';
                b.style.height = size + 'px';
                b.style.left = Math.random() * 100 + 'vw';
                b.style.animationDuration = (Math.random() * 3 + 4) + 's';
                b.style.animationDelay = (Math.random() * 5) + 's';
                container.appendChild(b);
            }
        }

        function createFireflies() {
            const container = document.getElementById('ambientOverlay');
            for(let i=0; i<40; i++) {
                const f = document.createElement('div');
                f.className = 'firefly';
                f.style.left = Math.random() * 100 + 'vw';
                f.style.top = Math.random() * 100 + 'vh';
                f.style.animationDuration = (Math.random() * 5 + 3) + 's';
                f.style.animationDelay = (Math.random() * 5) + 's';
                container.appendChild(f);
            }
        }

        function createStars() {
            const container = document.getElementById('ambientOverlay');
            for(let i=0; i<60; i++) {
                const s = document.createElement('div');
                s.innerText = '';
                s.style.position = 'absolute';
                s.style.color = '#fff';
                s.style.fontSize = (Math.random() * 10 + 5) + 'px';
                s.style.left = Math.random() * 100 + 'vw';
                s.style.top = Math.random() * 100 + 'vh';
                s.style.opacity = Math.random();
                container.appendChild(s);
                gsap.to(s, { opacity: 0.2, duration: Math.random() * 2 + 1, repeat: -1, yoyo: true });
            }
        }



        let step = 1;
        const total = 4;
        let userAvatarData = "";
        let userSocialData = "";
        let currentUser = null; // Store user from server
        let selectedInterests = new Set();
        let chatInterval = null;


        // Image Listeners
        setTimeout(() => {
            const photoInput = document.getElementById('photos');
            const socialInput = document.getElementById('socialQr');

            if(photoInput) {
                photoInput.addEventListener('change', function(e) {
                    if (e.target.files && e.target.files[0]) {
                        const reader = new FileReader();
                        reader.onload = function(evt) { 
                            userAvatarData = evt.target.result; 
                            const p = document.getElementById('photosPreview');
                            p.src = userAvatarData;
                            p.style.display = 'block';
                        };
                        reader.readAsDataURL(e.target.files[0]);
                    }
                });
            }

            if(socialInput) {
                socialInput.addEventListener('change', function(e) {
                    if (e.target.files && e.target.files[0]) {
                        const reader = new FileReader();
                        reader.onload = function(evt) { 
                            userSocialData = evt.target.result; 
                            const p = document.getElementById('socialQrPreview');
                            p.src = userSocialData;
                            p.style.display = 'block';
                        };
                        reader.readAsDataURL(e.target.files[0]);
                    }
                });
            }
        }, 1000);
        const cursor = document.getElementById('customCursor');
        const pos = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
        const mouse = { x: pos.x, y: pos.y };
        const speed = 0.15;

        // Custom Cursor Movement
        window.addEventListener('mousemove', e => {
            mouse.x = e.clientX;
            mouse.y = e.clientY;
            createTrail(e.clientX, e.clientY);

            // Parallax Blobs
            const xShift = (e.clientX - window.innerWidth / 2) / 60;
            const yShift = (e.clientY - window.innerHeight / 2) / 60;
            gsap.to(".bg-blobs", { x: xShift, y: yShift, duration: 1.5, ease: "power1.out" });

            // Masterpiece Mascot 3D Tilt
            const mascotContainer = document.querySelector('.mascot-container');
            if (mascotContainer) {
                const rect = mascotContainer.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                const tiltX = (e.clientY - centerY) / 10;
                const tiltY = (e.clientX - centerX) / -10;
                gsap.to(mascotContainer, {
                    rotationX: tiltX,
                    rotationY: tiltY,
                    duration: 0.5,
                    ease: "power2.out"
                });
            }

            // Holographic Shimmer Parallax
            const box = document.getElementById('mainBox');
            if(box) {
                const boxRect = box.getBoundingClientRect();
                const boxX = (e.clientX - (boxRect.left + boxRect.width/2)) / 30;
                const boxY = (e.clientY - (boxRect.top + boxRect.height/2)) / 30;
                gsap.to(box, {
                    rotationY: boxX,
                    rotationX: -boxY,
                    duration: 0.8, // Faster, more responsive follow
                    ease: "power2.out", 
                    perspective: 1000,
                    force3D: true, // Force GPU layer
                    overwrite: "auto"
                });
                
                // Update CSS variable for shimmer gradient
                const mouseX = (e.clientX - boxRect.left) / boxRect.width * 100;
                const mouseY = (e.clientY - boxRect.top) / boxRect.height * 100;
                box.style.setProperty('--shimmer-x', `${mouseX}%`);
                box.style.setProperty('--shimmer-y', `${mouseY}%`);
            }
        });

        // Click Heart Pop
        window.addEventListener('click', e => {
            const h = document.createElement('div');
            h.className = 'heart-pop';
            h.innerText = ["", "", "", ""][Math.floor(Math.random() * 4)];
            h.style.left = e.clientX + 'px';
            h.style.top = e.clientY + 'px';
            document.body.appendChild(h);
            setTimeout(() => h.remove(), 800);
            playSound('pop');
        });





        // Background Blobs
        gsap.to("#blob1", { x: "100vw", y: "50vh", duration: 20, repeat: -1, yoyo: true, ease: "sine.inOut" });
        gsap.to("#blob2", { x: "-80vw", y: "-40vh", duration: 25, repeat: -1, yoyo: true, ease: "sine.inOut" });
        gsap.to("#blob3", { x: "40vw", y: "-60vh", duration: 18, repeat: -1, yoyo: true, ease: "sine.inOut" });

        // Ambient Petals
        function createPetals() {
            const container = document.getElementById('ambientOverlay');
            for(let i=0; i<30; i++) {
                const petal = document.createElement('div');
                petal.className = 'petal';
                const size = Math.random() * 10 + 10;
                petal.style.width = size + 'px';
                petal.style.height = (size * 0.8) + 'px';
                petal.style.left = Math.random() * 100 + 'vw';
                petal.style.animationDuration = (Math.random() * 5 + 5) + 's';
                petal.style.animationDelay = (Math.random() * 10) + 's';
                petal.style.background = ['#ffc2d1', '#e0c3fc', '#ffffff'][Math.floor(Math.random()*3)];
                container.appendChild(petal);
            }
        }
        createPetals();

        // Ambient Clouds Animation
        function createClouds() {
            const container = document.getElementById('ambientOverlay');
            for(let i=0; i<6; i++) {
                const cloud = document.createElement('div');
                cloud.className = 'cloud-bg';
                cloud.style.top = Math.random() * 100 + 'vh';
                cloud.style.left = '-400px';
                container.appendChild(cloud);
                
                const speed = 40 + Math.random() * 60;
                gsap.to(cloud, {
                    x: window.innerWidth + 800,
                    duration: speed,
                    repeat: -1,
                    delay: Math.random() * speed,
                    ease: "none"
                });
            }
        }
        createClouds();

        // Heart Rain
        function createRain() {
            const hearts = ["", "", "", "", ""];
            setInterval(() => {
                const h = document.createElement('div');
                h.classList.add('floating-heart');
                h.innerText = hearts[Math.floor(Math.random() * hearts.length)];
                h.style.left = Math.random() * 100 + "vw";
                h.style.top = "-50px";
                document.body.appendChild(h);
                gsap.to(h, {
                    y: window.innerHeight + 100,
                    x: (Math.random() - 0.5) * 200,
                    rotation: Math.random() * 360,
                    duration: Math.random() * 5 + 5,
                    ease: "none",
                    onComplete: () => h.remove()
                });
            }, 800);
        }
        createRain();

        // Typewriter Effect for Suggester
        let typeTimer;
        // Safety Alert Function
        function showSafetyAlert(msg) {
            const alertBox = document.createElement('div');
            alertBox.style.position = 'fixed';
            alertBox.style.top = '20px';
            alertBox.style.left = '50%';
            alertBox.style.transform = 'translateX(-50%)';
            alertBox.style.background = '#ff4d4d'; // Red for Alert
            alertBox.style.color = 'white';
            alertBox.style.padding = '15px 25px';
            alertBox.style.borderRadius = '50px';
            alertBox.style.boxShadow = '0 10px 30px rgba(255, 77, 77, 0.4)';
            alertBox.style.zIndex = '99999';
            alertBox.style.fontWeight = '700';
            alertBox.style.fontSize = '0.9rem';
            alertBox.style.display = 'flex';
            alertBox.style.alignItems = 'center';
            alertBox.style.gap = '10px';
            alertBox.innerHTML = `<span></span> ${msg}`;
            
            document.body.appendChild(alertBox);

            gsap.from(alertBox, { y: -50, opacity: 0, duration: 0.5, ease: 'back.out' });

            setTimeout(() => {
                gsap.to(alertBox, { y: -50, opacity: 0, duration: 0.5, onComplete: () => alertBox.remove() });
            }, 3000);
        }

        function typeMessage(text) {
            const el = document.getElementById('suggestionText');
            clearInterval(typeTimer);
            el.innerText = "";
            let i = 0;
            typeTimer = setInterval(() => {
                if (i < text.length) {
                    el.innerText += text.charAt(i);
                    i++;
                } else {
                    clearInterval(typeTimer);
                }
            }, 30);
        }

        function updateSuggestions() {
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const score = name.length > 0 ? (email.includes('@') ? 60 : 40) : 10;
            document.getElementById('loveFill').style.width = score + "%";

            let msg = "Tell me your name so I can start matching your energy!";
            if (name) msg = `Wait, ${name}... you look so cute today! `;
            if (email.includes('@')) msg = `Email saved! Almost ready to find your soulmate! `;

            typeMessage(msg);
        }

        function showStardust() {
            const screen = document.getElementById('stardustScreen');
            screen.style.display = 'flex';
            gsap.from("#stardustScreen h1", { scale: 0.5, opacity: 0, duration: 2, ease: "elastic.out(1, 0.3)" });
            // Hide everything else
            document.getElementById('mainBox').style.display = 'none';
        }

        function toggleChip(el) {
            el.classList.toggle('selected');
            const interest = el.innerText.split(' ')[0];
            if (selectedInterests.has(interest)) selectedInterests.delete(interest);
            else selectedInterests.add(interest);
            updateSuggestions();
        }

        function updateProgress() {
            document.getElementById('progress').style.width = (step / total) * 100 + "%";
            document.getElementById('backBtn').style.display = step === 1 ? "none" : "block";
            document.getElementById('nextBtn').innerText = step === total ? "Find Match " : "Continue ";
        }

        function nextStep() {
            // Validation Logic
            if (step === 1) {
                const nameEl = document.getElementById('name');
                const emailEl = document.getElementById('email');
                const ageEl = document.getElementById('age');
                
                // Clear errors
                [nameEl, emailEl, ageEl].forEach(el => el.style.border = '2px solid transparent');

                if (!nameEl.value.trim() || !emailEl.value.trim() || !ageEl.value) {
                    showSafetyAlert("Oops! Please fill in all the required magic fields! (Name, Email, Age) ");
                    if(!nameEl.value.trim()) nameEl.style.border = '2px solid red';
                    if(!emailEl.value.trim()) emailEl.style.border = '2px solid red';
                    if(!ageEl.value) ageEl.style.border = '2px solid red';
                    return;
                }

                if (parseInt(ageEl.value) < 18) {
                    showSafetyAlert("Sorry bestie! You must be 18+ to use this app. ");
                    ageEl.style.border = '2px solid red';
                    return;
                }
            }
            if (step === 3) {
                const photo = document.getElementById('photos').files[0];
                const social = document.getElementById('socialQr').files[0];
                if (!photo || !social) {
                    showSafetyAlert("We need both your cute face and your social QR! ");
                    if(!photo) document.getElementById('photos').parentElement.style.border = '2px dashed red';
                    if(!social) document.getElementById('socialQr').parentElement.style.border = '2px dashed red';
                    return;
                } else {
                     document.getElementById('photos').parentElement.style.border = 'none';
                     document.getElementById('socialQr').parentElement.style.border = 'none';
                }
            }

            if (step < total) {
                gsap.to(`#step${step}`, {
                    opacity: 0, 
                    x: -100, 
                    rotationY: -20,
                    scale: 0.9,
                    duration: 0.6, 
                    ease: "power2.inOut",
                    onComplete: () => {
                        document.getElementById(`step${step}`).classList.remove('active');
                        step++;
                        document.getElementById(`step${step}`).classList.add('active');
                        const elements = document.getElementById(`step${step}`).children;
                        gsap.fromTo(`#step${step}`, 
                            { opacity: 0, x: 100, rotationY: 20, scale: 0.9 },
                            { opacity: 1, x: 0, rotationY: 0, scale: 1, duration: 0.8, ease: "power3.out" }
                        );
                        gsap.fromTo(elements, 
                            { opacity: 0, y: 30, filter: 'blur(15px)' },
                            { opacity: 1, y: 0, filter: 'blur(0px)', duration: 0.6, stagger: 0.1, ease: "back.out(1.4)", delay: 0.3 }
                        );
                        updateProgress();
                    }
                });
            } else finalize();
        }

        function prevStep() {
            gsap.to(`#step${step}`, {
                opacity: 0, 
                x: 100, 
                rotationY: 20,
                scale: 0.9,
                duration: 0.6, 
                ease: "power2.inOut",
                onComplete: () => {
                    document.getElementById(`step${step}`).classList.remove('active');
                    step--;
                    document.getElementById(`step${step}`).classList.add('active');
                    const elements = document.getElementById(`step${step}`).children;
                    gsap.fromTo(`#step${step}`, 
                        { opacity: 0, x: -100, rotationY: -20, scale: 0.9 },
                        { opacity: 1, x: 0, rotationY: 0, scale: 1, duration: 0.8, ease: "power3.out" }
                    );
                    gsap.fromTo(elements, 
                        { opacity: 0, y: 30, filter: 'blur(15px)' },
                        { opacity: 1, y: 0, filter: 'blur(0px)', duration: 0.6, stagger: 0.1, ease: "back.out(1.4)", delay: 0.3 }
                    );
                    updateProgress();
                }
            });
        }

        let cards = [];
        let currentCardIndex = 0;
        let lastLikedProfile = null;
        // profilePool removed for Real User Only system

        function finalize() {
            document.getElementById('loader').classList.add('active');
            const loaders = [
                "Mixing Love Potions...",
                "Consulting the Stars...",
                "Baking Boba Pearls...",
                "Painting the Sky Pink...",
                "Finding Your Vibe Twin..."
            ];
            let lIdx = 0;
            const lTimer = setInterval(() => {
                document.querySelector('#loader p').innerText = loaders[lIdx % loaders.length];
                lIdx++;
            }, 600);

             // SERVER INTEGRATION START
            const formData = new FormData();
            formData.append('name', document.getElementById('name').value);
            formData.append('email', document.getElementById('email').value);
            formData.append('age', document.getElementById('age').value);
            formData.append('gender', document.getElementById('gender').value);
            formData.append('interestedIn', document.getElementById('interestedIn').value);
            formData.append('lookingFor', document.getElementById('relType').value);
            formData.append('interests', JSON.stringify(Array.from(selectedInterests)));
            
            const photoFile = document.getElementById('photos').files[0];
            const socialFile = document.getElementById('socialQr').files[0];
            if(photoFile) formData.append('photo', photoFile);
            if(socialFile) formData.append('socialQr', socialFile);

            // Attempt to talk to the "Waiter" (Server)
            fetch(`${API_BASE}/register`, {
                method: 'POST',
                body: formData
            })
            .then(res => {
                if (res.status === 410) { showStardust(); throw new Error("SELF_DESTRUCT"); }
                return res.json();
            })
            .then(data => {
                if(data.success) {
                    currentUser = data.user;
                    console.log(" Data sent to server!");
                    // Now ask for matches with our ID
                    return fetch(`${API_BASE}/matches?userId=${currentUser.id}`);
                } else if (data.error) {
                     showSafetyAlert(data.error);
                     throw new Error("Validation Error");
                } else { throw new Error("Server registration failed"); }
            })
            .then(r => r.json())
            .then(matchData => {
                clearInterval(lTimer);
                document.getElementById('loader').classList.remove('active');
                
                let finalMatches = [];
                if (matchData && matchData.source === 'real' && matchData.matches.length > 0) {
                    finalMatches = matchData.matches;
                } else {
                    finalMatches = []; // No fallback for real system
                }
                
                document.getElementById('kawaiiForm').style.display = 'none';
                document.getElementById('revealScreen').style.display = 'block';
                renderDeck(finalMatches);
            })
            .catch(err => {
                if(err.message === "SELF_DESTRUCT") return;
                clearInterval(lTimer);
                document.getElementById('loader').classList.remove('active');
                // No simulated fallback
                document.getElementById('kawaiiForm').style.display = 'none';
                document.getElementById('revealScreen').style.display = 'block';
                renderDeck([]); 
            });
            // SERVER INTEGRATION END
        }

        function renderDeck(data = []) {
            const container = document.getElementById('swipeDeck');
            container.innerHTML = '';
            
            if (!data || data.length === 0) {
                container.innerHTML = `
                    <div style="text-align:center; padding:50px; color:var(--kawaii-pink-dark);">
                        <div style="font-size:4rem; margin-bottom:20px;"></div>
                        <h2 style="font-family:'Fredoka One', cursive;">The Sky is Quiet...</h2>
                        <p style="font-weight:700; opacity:0.8;">Waiting for more cuties to join! <br>Check back soon </p>
                        <button class="enter-btn" style="margin-top:30px; transform:scale(0.8);" onclick="location.reload()">Refresh Hub </button>
                    </div>`;
                document.getElementById('deckCounter').style.display = 'none';
                return;
            }

            cards = [...data];
            currentCardIndex = cards.length - 1;
            cards.forEach((p, i) => {
                const cardEl = document.createElement('div');
                cardEl.className = 'swipe-card';
                cardEl.style.zIndex = i;
                const tagsHtml = p.tags.map(t => `<span class="card-tag">${t}</span>`).join('');
                const flagsHtml = p.flags ? p.flags.map(f => `<span class="card-flag" style="font-size:0.7rem; color:var(--kawaii-pink-dark); display:block; margin-top:5px; font-weight:700;"> ${f}</span>`).join('') : '';
                cardEl.innerHTML = `
                    <div class="match-score"> ${p.matchScore ? p.matchScore + '%' : '90%'} Match</div>
                    <img src="${p.img}" class="swipe-card-img">
                    <div class="swipe-card-info">
                        <div class="swipe-card-name">${p.name}, ${p.age}</div>
                        <div class="swipe-card-bio">${p.bio}</div>
                        <div class="card-tags">${tagsHtml}</div>
                        ${flagsHtml}
                    </div>`;
                container.appendChild(cardEl);
                initSwipe(cardEl, p);
            });
            updateCounter();
        }

        function initSwipe(el, profile) {
            let startX, moveX;
            el.addEventListener('mousedown', (e) => {
                startX = e.clientX;
                const onMove = (e) => {
                    moveX = e.clientX - startX;
                    const dragDist = Math.abs(moveX);
                    // Squish & Stretch Physics
                    const scaleX = 1 - (dragDist / 1000);
                    const scaleY = 1 + (dragDist / 2000);
                    gsap.set(el, { 
                        x: moveX, 
                        rotation: moveX / 10,
                        scaleX: scaleX,
                        scaleY: scaleY,
                        zIndex: 1000
                    });
                };
                const onEnd = () => {
                    document.removeEventListener('mousemove', onMove);
                    document.removeEventListener('mouseup', onEnd);
                    if (Math.abs(moveX) > 100) completeSwipe(el, moveX > 0 ? 1 : -1, profile);
                    else gsap.to(el, { x: 0, rotation: 0, scaleX: 1, scaleY: 1, duration: 0.5, ease: "elastic.out(1, 0.3)" });
                };
                document.addEventListener('mousemove', onMove);
                document.addEventListener('mouseup', onEnd);
            });
        }

        function completeSwipe(el, dir, profile) {
            if (el.dataset.isSwiping) return; // Guard against multiple fires
            el.dataset.isSwiping = 'true';

            if (dir === 1) lastLikedProfile = profile;
            
            // Immediately decrement and check
            currentCardIndex--;
            updateCounter();

            gsap.to(el, {
                x: dir * 500, opacity: 0, duration: 0.5, onComplete: () => {
                    el.remove();
                    if (currentCardIndex < 0) {
                        // 1s Delay for suspense after last card
                        setTimeout(() => showFinalReveal(), 1000);
                    }
                }
            });
        }

        function updateCounter() {
            document.getElementById('deckCounter').innerText = `${currentCardIndex + 1} matches remaining`;
        }

        function showFinalReveal() {
            document.getElementById('swipeDeck').style.display = 'none';
            document.querySelector('.swipe-buttons').style.display = 'none';
            document.getElementById('deckCounter').style.display = 'none';

            const final = lastLikedProfile || cards[0];
            document.getElementById('finalMatchImg').src = final.img;
            document.getElementById('finalMatchName').innerText = final.name;

            // Badge Logic
            const badges = ["Boba Prince", "Matcha Queen", "Pixel Pal", "Art Angel", "Hike Hero"];
            const randomBadge = badges[Math.floor(Math.random() * badges.length)];
            document.getElementById('personalityBadge').innerText = ` ${randomBadge}`;

            // Date Compass logic
            const dates = [
                "Cozy Cat Cafe Chill ",
                "Pastel Paint Session ",
                "Arcade & Boba Night ",
                "Secret Moonlight Picnic ",
                "Kawaii Photo Booth Tour "
            ];
            document.getElementById('dateSuggestion').innerText = dates[Math.floor(Math.random() * dates.length)];

            // Horoscope & Compatibility
            const scores = [85, 88, 92, 95, 98, 99];
            const compatibility = scores[Math.floor(Math.random() * scores.length)];
            const horoscopes = [
                "Your energies are perfectly aligned! ",
                "A rare cosmic connection is forming! ",
                "Venus is smiling on this match! ",
                "Your heartbeats are in perfect sync! ",
                "A magical future awaits you both! "
            ];

            document.getElementById('horoscopeText').innerText = `${horoscopes[Math.floor(Math.random() * horoscopes.length)]} ${compatibility}% Compatibility!`;
            
            document.getElementById('luckyHoroscope').style.display = 'block';
            gsap.from("#luckyHoroscope", { y: 20, opacity: 0, duration: 0.8, delay: 0.5, ease: "back.out" });

            document.getElementById('finalMatchCelebration').style.display = 'block';
            // Trigger Ethereal Bloom
            etherealBloomReveal();
            
            document.getElementById('dateCompass').style.display = 'block';

            // User Images Showcase
            const showcase = document.getElementById('userShowcase');
            showcase.innerHTML = '';
            
            if (userAvatarData) {
                const div = document.createElement('div');
                div.style.textAlign = 'center';
                div.innerHTML = `<p style="font-weight:700; margin-bottom:5px; color:var(--kawaii-pink-dark);">You </p><img src="${userAvatarData}" style="width:100px; height:100px; object-fit:cover; border-radius:50%; border:4px solid var(--kawaii-pink);">`;
                showcase.appendChild(div);
            }
            
            if (userSocialData) {
                const div = document.createElement('div');
                div.style.textAlign = 'center';
                div.innerHTML = `<p style="font-weight:700; margin-bottom:5px; color:var(--kawaii-pink-dark);">Connect! </p><img src="${userSocialData}" style="width:100px; height:100px; object-fit:contain; border-radius:15px; border:4px solid var(--kawaii-mint);">`;
                showcase.appendChild(div);
            }

            // Create Trend-Savvy Conversation Starter
            const starters = [
                "What's a 'green flag' you look for? ",
                "Deep talk: What's your love language? ",
                "Let's go on a 'Dopamine Date' - surprise me! ",
                "What's your 'Roman Empire' lately? ",
                "Vibe check: Early bird or Night owl? "
            ];
            const starterText = starters[Math.floor(Math.random() * starters.length)];
            
            const convoContainer = document.getElementById('convoContainer');
            if(convoContainer) {
                convoContainer.innerHTML = '';
                const convoDiv = document.createElement('div');
                convoDiv.className = 'date-compass';
                convoDiv.style.marginTop = '20px';
                convoDiv.style.background = 'rgba(255, 255, 255, 0.6)';
                convoDiv.style.backdropFilter = 'blur(10px)';
                convoDiv.innerHTML = `<div class="compass-title"> Deep Vibe Check:</div><div class="compass-suggestion">${starterText}</div>`;
                convoContainer.appendChild(convoDiv);
            }

            // Match Gallery & Socials
            const extrasContainer = document.getElementById('extrasContainer');
            if(extrasContainer) {
                extrasContainer.innerHTML = `
                    <div style="margin-bottom:20px; margin-top:25px;">
                        <p style="font-weight:700; color:var(--kawaii-pink-dark); margin-bottom:10px;"> ${final.name}'s Gallery</p>
                        <div style="display:flex; justify-content:center; gap:10px;">
                            <img src="${final.img}" onclick="openLightbox(this.src)" style="cursor:zoom-in; width:60px; height:60px; border-radius:10px; object-fit:cover; border:2px solid white;">
                            <img src="${final.img}" onclick="openLightbox(this.src)" style="cursor:zoom-in; width:60px; height:60px; border-radius:10px; object-fit:cover; border:2px solid white; filter:hue-rotate(45deg);">
                            <img src="${final.img}" onclick="openLightbox(this.src)" style="cursor:zoom-in; width:60px; height:60px; border-radius:10px; object-fit:cover; border:2px solid white; filter:sepia(0.5);">
                            <img src="${final.img}" onclick="openLightbox(this.src)" style="cursor:zoom-in; width:60px; height:60px; border-radius:10px; object-fit:cover; border:2px solid white; filter:grayscale(0.8);">
                            <div style="width:60px; height:60px; border-radius:10px; background:var(--kawaii-pink); color:white; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:0.8rem;">+5</div>
                        </div>
                    </div>
                     <div style="background:white; padding:15px; border-radius:15px; border:2px dashed var(--kawaii-pink); display:inline-block;">
                        <p style="font-weight:700; color:var(--kawaii-pink-dark); margin-bottom:5px;"> Scan to Add ${final.name}</p>
                        <img src="${final.socialQr || 'C:/Users/Meet Sutariya/.gemini/antigravity/brain/a7b6e9a5-77c2-4454-81db-861d7b99a034/kawaii_qr_code_final_1770047427805.png'}" onclick="openLightbox(this.src)" style="cursor:zoom-in; width:120px; border-radius:10px;">
                    </div>
                `;
            }


            gsap.from("#userShowcase", { y: 20, opacity: 0, duration: 0.4, delay: 0.2, ease: "back.out" });
            playSound('success');
        }

        function forceSwipe(direction) {
            const currentEl = document.getElementById('swipeDeck').lastElementChild;
            if (currentEl) completeSwipe(currentEl, direction === 'right' ? 1 : -1, cards[currentCardIndex]);
        }

        // Radio Toggle


        //  Mood Switcher Logic (Neo-Y2K & Abyss Systems)
        let particleInterval;
        let cloudInterval; // Separate interval for clouds
        
        //  Searchlight & Sparkle Tracking
        document.addEventListener('mousemove', (e) => {
            // Abyss Searchlight
            if (document.body.classList.contains('theme-ocean')) {
                const mask = document.querySelector('.searchlight-mask');
                if(mask) {
                    mask.style.setProperty('--x', e.clientX + 'px');
                    mask.style.setProperty('--y', e.clientY + 'px');
                }
            }
            // Kawaii Sparkle Trail
            else if (!document.body.classList.contains('theme-ocean') && !document.body.classList.contains('theme-moonlight')) {
                if(Math.random() > 0.8) { // Don't spawn on every pixel
                    const s = document.createElement('div');
                    s.innerHTML = Math.random() > 0.5 ? '' : '';
                    s.className = 'sparkle-trail';
                    s.style.left = e.clientX + 'px';
                    s.style.top = e.clientY + 'px';
                    document.body.appendChild(s);
                    setTimeout(() => s.remove(), 800);
                }
            }
        });

        function clearTopParticles() {
            clearInterval(particleInterval);
            clearInterval(cloudInterval);
            document.querySelectorAll('.theme-particle').forEach(p => p.remove());
            document.querySelectorAll('.cloud-bg').forEach(c => c.remove());
        }

        function createThemeParticles(type) {
            clearTopParticles();
            
            if (type === 'default') {
                // Living Sky: Falling "Cute" Rain (No rising balloons)
                const skyIcons = ['', '', '', '', '', ''];
                particleInterval = setInterval(() => {
                    const icon = skyIcons[Math.floor(Math.random() * skyIcons.length)];
                    const p = document.createElement('div');
                    p.innerHTML = icon;
                    p.className = 'theme-particle cute-particle';
                    p.style.left = Math.random() * 100 + 'vw';
                    p.style.top = '-20vh'; // Start above
                    
                    const size = Math.random() * 1.5 + 1.2 + 'rem'; 
                    p.style.fontSize = size;
                    
                    p.style.animationDuration = (Math.random() * 5 + 4) + 's'; // Normal fall speed
                    p.style.animationDelay = '0s';
                    
                    document.body.appendChild(p);
                    setTimeout(() => p.remove(), 9000);
                }, 400); 

                // Extra Clouds
                cloudInterval = setInterval(() => {
                    const c = document.createElement('div');
                    c.className = 'cloud-bg';
                    c.style.top = Math.random() * 40 + 'vh'; // Only in upper sky
                    c.style.left = '-300px';
                    c.style.opacity = '0.9';
                    document.body.appendChild(c);
                    
                    const speed = Math.random() * 30 + 40;
                    gsap.to(c, {
                        x: window.innerWidth + 500,
                        duration: speed,
                        ease: "none",
                        onComplete: () => c.remove()
                    });
                }, 4000);
            } 
            else if (type === 'theme-ocean') {
                // Bioluminescent Abyss: Bubbles + Ambient Fish
                particleInterval = setInterval(() => {
                    // 1. Bubbles (Frequent)
                    const p = document.createElement('div');
                    p.className = 'theme-particle neon-bubble';
                    p.style.left = Math.random() * 100 + 'vw';
                    const size = Math.random() * 15 + 5;
                    p.style.width = size + 'px';
                    p.style.height = size + 'px';
                    p.style.animationDuration = (Math.random() * 6 + 4) + 's';
                    document.body.appendChild(p);
                    setTimeout(() => p.remove(), 10000);

                    // 2. Ambient Creatures (Less Frequent) - Visible without light
                    if (Math.random() > 0.7) {
                        const fishIcons = ['', '', '', '', ''];
                        const f = document.createElement('div');
                        f.innerHTML = fishIcons[Math.floor(Math.random() * fishIcons.length)];
                        f.className = 'theme-particle ocean-ambient';
                        f.style.top = Math.random() * 80 + 10 + 'vh';
                        f.style.left = '-10vw'; // Start off screen
                        f.style.animationDuration = (Math.random() * 15 + 10) + 's'; // Slow swim
                        document.body.appendChild(f);
                        setTimeout(() => f.remove(), 25000);
                    }
                }, 200);
            }
            else if (type === 'theme-moonlight') {
                // Moonlight: Cosmic/Magic Particles (Sparser)
                const spaceIcons = ['', '', '', '', '', '', '', ''];
                particleInterval = setInterval(() => {
                    const icon = spaceIcons[Math.floor(Math.random() * spaceIcons.length)];
                    const p = document.createElement('div');
                    p.innerHTML = icon;
                    p.className = 'theme-particle cute-particle'; // Re-use float animation
                    p.style.left = Math.random() * 100 + 'vw';
                    p.style.top = '-20vh'; // Force start above screen
                    p.style.fontSize = (Math.random() * 1.5 + 1) + 'rem';
                    p.style.animationDuration = (Math.random() * 8 + 5) + 's'; 
                    p.style.opacity = '0.7';
                    p.style.textShadow = '0 0 10px rgba(255,255,255,0.5)';
                    document.body.appendChild(p);
                    setTimeout(() => p.remove(), 12000);
                }, 1200); // Much slower spawn rate (was 350)
            }
        }

        function setMood(themeClass) {
            document.body.className = ''; // Reset
            if (themeClass !== 'default') {
                document.body.classList.add(themeClass);
            }
            createThemeParticles(themeClass);
            
            // Play change sound
            playSound('pop');
            
            // Animate transition (flash overlay)
            const flash = document.createElement('div');
            flash.style.position = 'fixed';
            flash.style.inset = '0';
            flash.style.background = 'white';
            flash.style.opacity = '0.5';
            flash.style.zIndex = '99999';
            flash.style.pointerEvents = 'none';
            document.body.appendChild(flash);
            gsap.to(flash, { opacity: 0, duration: 0.5, onComplete: () => flash.remove() });
        }
        
        // Init default particles
        createThemeParticles('default');

        // Match Reveal Suspense

        //  "Grand Ethereal" Reveal (Maximum Beauty)
        function etherealBloomReveal() {
            const tl = gsap.timeline();
            
            // 1. Setup Elements
            // Glow Overlay
            const glow = document.createElement('div');
            glow.style.position = 'fixed';
            glow.style.inset = '0';
            glow.style.background = 'radial-gradient(circle at center, rgba(255,255,255,1) 0%, rgba(255,230,240,0.5) 50%, transparent 100%)';
            glow.style.backdropFilter = 'blur(10px)';
            glow.style.zIndex = '100000';
            glow.style.opacity = '0';
            glow.style.pointerEvents = 'none';
            document.body.appendChild(glow);

            // God Rays
            const rays = document.createElement('div');
            rays.className = 'god-rays';
            document.body.appendChild(rays);

            // 2. The Grand Sequence (TURBO SPEED)
            // Phase 1: Suspense (Instant Dim)
            tl.to("body", { backgroundColor: "#1a0b2e", duration: 0.2, ease: "power4.out" }) 
              .to(rays, { opacity: 0.8, duration: 0.4, ease: "power2.out" }, "<")
              .to(rays, { rotation: 360, duration: 10, ease: "none", repeat: -1 }, "<")
              
            // Phase 2: The Pulse (Micro Flash)
              .to(glow, { opacity: 0.7, duration: 0.15, ease: "sine.inOut", yoyo: true, repeat: 1 })
            
            // Phase 3: THE BLAST (5-Way Party Pop)
              .add(() => {
                  // 1. Center Super Blast
                  confetti({ particleCount: 250, spread: 360, startVelocity: 70, gravity: 0.5, origin: { x: 0.5, y: 0.5 }, colors: ['#ffffff', '#ff1a7d', '#ffd700', '#ff00ff'], shapes: ['circle', 'square'], scalar: 1.5 });
                  
                  // 2. Bottom Left Pop
                  confetti({ particleCount: 100, angle: 60, spread: 70, origin: { x: 0, y: 1 }, colors: ['#ff1a7d', '#ffffff'] });
                  
                  // 3. Bottom Right Pop
                  confetti({ particleCount: 100, angle: 120, spread: 70, origin: { x: 1, y: 1 }, colors: ['#ff1a7d', '#ffffff'] });
                  
                  // 4. Side Blasts
                  confetti({ particleCount: 60, angle: 90, spread: 100, origin: { x: 0.5, y: 0.7 }, colors: ['#ffd700'] });
                  
                  // 5. Shower from Top
                  confetti({ particleCount: 80, spread: 180, origin: { x: 0.5, y: 0 }, gravity: 0.8, scalar: 0.7, colors: ['#ffffff', '#fff0f5'] });

                  playSound('success');
                  fadeAudio(1.0);
              })
              .to(glow, { opacity: 1, duration: 0.05, ease: "power4.in" }) // Flash White
              .to(glow, { opacity: 0, duration: 0.4, ease: "power2.out", onComplete: () => glow.remove() }) // Ultra Fast Fade
              
            // Phase 4: The Reveal (Instant pop)
              .to("body", { backgroundColor: "var(--bg-main)", duration: 0.3 }, "-=0.3") 
              .to(rays, { opacity: 0, duration: 0.3, onComplete: () => rays.remove() }, "-=0.3")
              .fromTo(".final-match-card", 
                  { y: 100, opacity: 0, scale: 0.5, filter: "blur(20px)", rotationX: 45 },
                  { y: 0, opacity: 1, scale: 1, filter: "blur(0px)", rotationX: 0, duration: 0.6, ease: "back.out(1.5)" },
                  "-=0.4"
              );
        }

        // Radio Toggle (Legacy - keeping for compatibility if needed, but we have new controls)
        function toggleRadio() {
            const audio = document.getElementById('bgMusic'); // Redirect to new audio
            if (audio.paused) {
                audio.play();
                fadeAudio(0.4);
            } else {
                fadeAudio(0);
                setTimeout(() => audio.pause(), 1500);
            }
        }
        // EXTREME MASTERPIECE: 3D Tunnel & Petal Storm
        let tunnelInterval, stormInterval;
        function createValentineTunnel() {
            // DENSE 3D TUNNEL (150ms for hurricane feel)
            tunnelInterval = setInterval(() => {
                const h = document.createElement('div');
                h.className = 'master-heart';
                if(Math.random() > 0.7) h.style.filter = 'blur(10px) opacity(0.5)'; // Add Bokeh Depth
                h.style.left = (40 + Math.random() * 20) + 'vw';
                h.style.top = (40 + Math.random() * 20) + 'vh';
                const speed = 2 + Math.random() * 3;
                h.style.animationDuration = speed + 's';
                document.body.appendChild(h);
                setTimeout(() => h.remove(), speed * 1000);
            }, 150);
            
            // PETAL STORM
            stormInterval = setInterval(() => {
                const p = document.createElement('div');
                p.className = 'petal-storm';
                p.style.left = Math.random() * 100 + 'vw';
                p.style.top = -20 + 'px';
                p.style.transform = `rotate(${Math.random() * 360}deg)`;
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 8000);
            }, 300);

            // Diamond Dust (Vibrant)
            setInterval(() => {
                const d = document.createElement('div');
                d.className = 'diamond-dust';
                d.style.left = Math.random() * 100 + 'vw';
                d.style.top = Math.random() * 100 + 'vh';
                document.body.appendChild(d);
                setTimeout(() => d.remove(), 1500);
            }, 100);
        }
        createValentineTunnel();

        function startApp() {
            clearInterval(tunnelInterval);
            clearInterval(stormInterval);
            document.querySelectorAll('.master-heart, .diamond-dust, .petal-storm, .neon-border').forEach(h => h.remove());
            const overlay = document.getElementById('enterOverlay');
            overlay.classList.add('zoom-exit');
            
            setTimeout(() => {
                overlay.classList.add('hidden');
                
                // THE CINEMATIC BLOOM
                const mainBox = document.getElementById('mainBox');
                mainBox.style.display = 'block';
                
                const tl = gsap.timeline();
                tl.to(mainBox, {
                    opacity: 1,
                    scale: 1,
                    y: 0,
                    filter: 'blur(0px)',
                    duration: 1.2,
                    ease: "expo.out"
                })
                .from("#formContainer > header", { y: 20, opacity: 0, duration: 0.8, ease: "back.out" }, "-=0.8")
                .from(".progress-track", { scaleX: 0, duration: 1, ease: "expo.out" }, "-=0.6")
                .from("#step1 > children", { y: -20, opacity: 0, stagger: 0.1, duration: 0.6, ease: "power2.out" }, "-=0.6");

            }, 200);
        }
    </script>
</body>

</html>